---
import { Image } from "astro:assets";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { useTranslations, getLocalizedPath } from "@/i18n/utils";
import { getCategories, getCategoryBySlug, getProductsByCategory } from "@/lib/collections";

export function getStaticPaths() {
	return getCategories().map((cat) => ({
		params: { category: cat.slug },
	}));
}

const { category } = Astro.params;
const lang = "en";
const t = useTranslations(lang);
const cat = getCategoryBySlug(category!);
const products = getProductsByCategory(category!);

if (!cat) return Astro.redirect("/404");
---

<BaseLayout title={cat.name[lang]} description={`${cat.name[lang]} - Artigiani del Salotto`}>
	<section class="pt-40 pb-20 bg-[#f8f7f2]">
		<div class="container mx-auto px-6 lg:px-20">
			<a
				href={getLocalizedPath("/", lang) + "#collections"}
				class="inline-flex items-center gap-2 text-sm text-slate-500 hover:text-[#d9b130] transition-colors mb-8"
			>
				<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
				</svg>
				{t("collections.backToCategories")}
			</a>

			<h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-slate-900 mb-4">
				{cat.name[lang]}
			</h1>
			<p class="text-lg text-slate-500 mb-16">
				{t("collections.products")}
			</p>

			{products.length === 0 ? (
				<p class="text-slate-500">{t("collections.noProducts")}</p>
			) : (
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
					{products.map((product) => (
						<a
							href={getLocalizedPath(`/collezioni/${category}/${product.slug}`, lang)}
							class="group block"
						>
							<div class="relative aspect-[4/3] overflow-hidden mb-6">
								<Image
									src={product.heroImage}
									alt={product.name[lang]}
									class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
								/>
							</div>
							<h3 class="text-xl font-bold text-slate-900 group-hover:text-[#d9b130] transition-colors mb-2">
								{product.name[lang]}
							</h3>
							<p class="text-sm text-slate-500 line-clamp-2">
								{product.description[lang]}
							</p>
						</a>
					))}
				</div>
			)}
		</div>
	</section>
</BaseLayout>
