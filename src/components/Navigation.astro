---
import { Image } from "astro:assets";

import {
	getLangFromUrl,
	useTranslations,
	getLocalizedPath,
	translatePath,
} from "@/i18n/utils";

import logo from "../assets/logo.png";

interface Props {
	currentPath?: string;
	lang?: "it" | "en";
	itPath?: string;
	enPath?: string;
}

const { currentPath = "", lang: propLang, itPath, enPath } = Astro.props;
const lang = propLang || getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const navItems = [
	{ href: getLocalizedPath("/", lang), label: t("nav.home") },
	{ href: "#quality", label: t("nav.about") },
	{ href: "#collections", label: t("nav.collections") },
	{ href: "#hero", label: t("nav.production") },
	{ href: "#how-it-works", label: t("nav.howItWorks") },
];
---

<!-- Navigation -->
<nav
	id="main-nav"
	class="sticky top-0 z-70 transition-all duration-300 bg-white border-b border-slate-100"
>
	<div
		class="container mx-auto px-6 lg:px-20 py-6 flex items-center justify-between"
	>
		<!-- Logo -->
		<a
			href={getLocalizedPath("/", lang)}
			class="flex items-center transition-opacity hover:opacity-80"
		>
			<Image
				src={logo}
				alt="Artigiani del Salotto"
				height={50}
				class="h-10 md:h-12 w-auto"
			/>
		</a>

		<!-- Desktop Navigation -->
		<div class="hidden lg:flex items-center gap-10">
			{
				navItems.map((item) => (
					<a
						href={item.href}
						class={`text-[11px] tracking-[0.2em] uppercase font-bold transition-colors ${
							currentPath === item.href ||
							currentPath.startsWith(item.href + "/")
								? "text-slate-900"
								: "text-slate-400 hover:text-slate-900"
						}`}
					>
						{item.label}
					</a>
				))
			}

			<!-- Language Switcher -->
			<div class="relative ml-4">
				<button
					id="lang-toggle"
					class="p-2 hover:bg-slate-50 transition-colors text-slate-800 flex items-center gap-1.5"
				>
					<span
						class="text-[10px] font-bold uppercase tracking-widest bg-slate-100 px-2 py-1"
						>{lang}</span
					>
				</button>
				<div
					id="lang-menu"
					class="hidden absolute right-0 mt-3 py-2 w-32 bg-white shadow-xl border border-slate-100 z-50 transition-all"
				>
					<a
						href={itPath || translatePath(currentPath, "it")}
						class="block px-4 py-2.5 text-xs font-bold text-slate-800 hover:bg-slate-50 transition-colors"
					>
						ðŸ‡®ðŸ‡¹ Italiano
					</a>
					<a
						href={enPath || translatePath(currentPath, "en")}
						class="block px-4 py-2.5 text-xs font-bold text-slate-800 hover:bg-slate-50 transition-colors"
					>
						ðŸ‡¬ðŸ‡§ English
					</a>
				</div>
			</div>
		</div>

		<!-- Mobile Menu Button -->
		<button
			id="mobile-menu-btn"
			class="lg:hidden relative w-10 h-10 flex flex-col items-center justify-center"
			aria-label="Menu"
		>
			<div class="space-y-1.5 px-2">
				<span class="block w-6 h-0.5 bg-slate-800"></span>
				<span class="block w-6 h-0.5 bg-slate-800"></span>
			</div>
		</button>
	</div>
</nav>

<!-- Mobile Menu Overlay -->
<div
	id="mobile-menu"
	class="group fixed inset-0 z-60 bg-white opacity-0 pointer-events-none transition-all duration-300 lg:hidden"
>
	<div
		class="flex flex-col items-center justify-center text-center w-full h-full"
	>
		<div class="space-y-8 px-6 py-8">
			{
				navItems.map((item) => (
					<a
						href={item.href}
						class="block text-2xl font-bold uppercase tracking-widest text-slate-800 hover:text-[#d9b130]"
					>
						{item.label}
					</a>
				))
			}
		</div>
	</div>
</div>

<style>
	#mobile-menu.active {
		opacity: 1;
		pointer-events: auto;
	}
</style>

<script>
	function initNavigation() {
		const nav = document.getElementById("main-nav");
		const btn = document.getElementById("mobile-menu-btn");
		const menu = document.getElementById("mobile-menu");
		const langBtn = document.getElementById("lang-toggle");
		const langMenu = document.getElementById("lang-menu");

		if (!nav || !btn || !menu) return;

		// Mobile menu toggle
		const toggleMenu = () => {
			const isActive = btn.classList.toggle("active");
			menu.classList.toggle("active");
			document.body.style.overflow = isActive ? "hidden" : "";
		};

		btn.addEventListener("click", toggleMenu);

		// Close mobile menu on link click
		menu.querySelectorAll("a").forEach((link) => {
			link.addEventListener("click", () => {
				btn.classList.remove("active");
				menu.classList.remove("active");
				document.body.style.overflow = "";
			});
		});

		// Language toggle
		langBtn?.addEventListener("click", (e) => {
			e.stopPropagation();
			langMenu?.classList.toggle("hidden");
		});

		document.addEventListener("click", () =>
			langMenu?.classList.add("hidden"),
		);
	}

	initNavigation();
	document.addEventListener("astro:after-swap", initNavigation);
</script>
