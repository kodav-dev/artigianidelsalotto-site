---
import { Image } from "astro:assets";
import { useTranslations } from "@/i18n/utils";

// Images
import product1 from "@/assets/home/gallery-1.webp"; // I will move them to src/assets/home/
import product2 from "@/assets/home/gallery-2.webp";
import product3 from "@/assets/home/gallery-3.webp";
import product4 from "@/assets/home/gallery-4.webp";

const { lang } = Astro.props;
const t = useTranslations(lang);

const images = [
    { src: product1, alt: "Pappardelle al cinghiale" },
    { src: product2, alt: "Vino e Pecorino" },
    { src: product3, alt: "Tiramis√π della casa" },
    { src: product4, alt: "L'Antica Corte" },
];
---

<section class="py-24 bg-black">
    <div class="w-full">
        <div class="text-center mb-16 px-6">
            <h2 class="text-3xl md:text-4xl font-bold mb-4 text-footer-bg">
                {t("home.galleryTitle")}
            </h2>
            <p class="text-lg text-white max-w-2xl mx-auto">
                {t("home.gallerySubtitle")}
            </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-0">
            {
                images.map((img, i) => (
                    <div
                        class="group relative aspect-square overflow-hidden cursor-pointer bg-white"
                        data-gallery-item={i}
                        data-src={img.src.src}
                    >
                        <Image
                            src={img.src}
                            alt={img.alt}
                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                            widths={[400, 500]}
                            sizes="(max-width: 639px) 100vw, (max-width: 1023px) 50vw, 25vw"
                        />
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300 flex items-center justify-center">
                            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-4 group-hover:translate-y-0">
                                <span class="bg-white/90 text-slate-900 px-4 py-2 text-sm font-semibold shadow-xl">
                                    Visualizza
                                </span>
                            </div>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<!-- Lightbox Root -->
<div
    id="lightbox"
    class="fixed inset-0 z-100 bg-black/95 backdrop-blur-sm opacity-0 pointer-events-none transition-all duration-300 flex items-center justify-center p-4 md:p-12 overflow-hidden"
>
    <button
        id="close-lightbox"
        class="absolute top-8 right-8 text-white hover:scale-110 transition-transform p-4 z-110"
        aria-label="Chiudi"
    >
        <svg
            class="w-10 h-10"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2.5"
                d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    </button>

    <div class="relative w-full h-full flex items-center justify-center">
        <img
            id="lightbox-img"
            src=""
            alt=""
            class="max-w-full max-h-full object-contain shadow-2xl scale-95 transition-transform duration-300"
        />
    </div>
</div>

<script>
    function initGallery() {
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById(
            "lightbox-img",
        ) as HTMLImageElement;
        const closeBtn = document.getElementById("close-lightbox");
        const items = document.querySelectorAll("[data-gallery-item]");

        const openLightbox = (src: string) => {
            if (!lightbox || !lightboxImg) return;
            lightboxImg.src = src;
            lightbox.classList.remove("opacity-0", "pointer-events-none");
            setTimeout(() => {
                lightboxImg.classList.remove("scale-95");
            }, 10);
            document.body.style.overflow = "hidden";
        };

        const closeLightbox = () => {
            if (!lightbox || !lightboxImg) return;
            lightbox.classList.add("opacity-0", "pointer-events-none");
            lightboxImg.classList.add("scale-95");
            document.body.style.overflow = "";
        };

        items.forEach((item) => {
            item.addEventListener("click", () => {
                const src = item.getAttribute("data-src");
                if (src) openLightbox(src);
            });
        });

        closeBtn?.addEventListener("click", (e) => {
            e.stopPropagation();
            closeLightbox();
        });

        lightbox?.addEventListener("click", (e) => {
            if (e.target === lightbox || e.target === closeBtn) closeLightbox();
        });

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeLightbox();
        });
    }

    initGallery();
    document.addEventListener("astro:after-swap", initGallery);
</script>
